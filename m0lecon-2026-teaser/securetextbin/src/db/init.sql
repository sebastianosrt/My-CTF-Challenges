CREATE DATABASE IF NOT EXISTS filestore;
USE filestore;

CREATE TABLE IF NOT EXISTS files (
    id BIGINT UNSIGNED PRIMARY KEY,
    filename VARCHAR(255) NOT NULL,
    content_type VARCHAR(255) NOT NULL,
    file_data MEDIUMBLOB NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

SET GLOBAL event_scheduler = ON;

CREATE EVENT IF NOT EXISTS purge_old_files
ON SCHEDULE EVERY 1 MINUTE
DO
  DELETE FROM files WHERE created_at < (NOW() - INTERVAL 5 MINUTE);
